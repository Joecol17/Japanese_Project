<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Game 2</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="icon" type="image/png" href="/images/japan.png">
  <link rel="shortcut icon" href="/images/japan.png">
  <link rel="icon" href="images/japan.png">
</head>
<body class="jp-theme">
  <header style="padding:12px;display:flex;gap:8px;align-items:center">
    <a class="leave-button" href="index.html">← Home</a>
    <a class="leave-button secondary" href="gambling.html">Leaderboard</a>
  </header>

  <main class="container" style="margin-top:28px;">
    <header style="margin-bottom:14px">
      <h1 style="margin:0;color:#fff">Blackjack — Table</h1>
      <p style="color:rgba(255,255,255,0.75);margin-top:6px">A simple blackjack layout — frontend + leaderboard (backend same as Slots).</p>
    </header>

    <section class="blackjack-area bj-table">
      <div class="panel" style="background:transparent;border:none;padding:0;margin-bottom:12px">
        <div class="credits">Chips: <span id="bjCredits" class="dark-credits">500</span></div>
        <div class="controls" style="justify-content:flex-end">
          <label>Bet:
            <select id="bjBet">
              <option>10</option>
              <option>25</option>
              <option>50</option>
              <option>100</option>
            </select>
          </label>
          <button id="bjDeal" class="navbutton">Deal</button>
        </div>
      </div>

      <div id="bjStatus" style="margin-top:12px;color:#ffd166;font-weight:700">Place your bet and deal.</div>

      <div style="margin-bottom:12px">
        <h3 style="color:var(--accent);margin:6px 0">Dealer</h3>
        <div class="bj-hand" id="dealerHand"></div>
      </div>

      <div>
        <h3 style="color:#ffd166;margin:6px 0">Player</h3>
        <div class="bj-hand" id="playerHand"></div>
        <div class="controls">
          <button id="bjHit" class="navbutton">Hit</button>
          <button id="bjStand" class="navbutton">Stand</button>
        </div>
      </div>

      <div style="margin-top:12px">
        <label style="color:rgba(255,255,255,0.85);">Your name: <input id="bjName" placeholder="Player" maxlength="20" style="margin-left:8px;padding:8px;border-radius:6px;border:none" /></label>
        <button id="bjSave" class="navbutton" style="margin-left:8px">Save Score</button>
      </div>

      <section class="global-leaderboard">
            <h3>Global Leaderboard</h3>
            <ol id="bjLb">
              <li>Loading…</li>
            </ol>
      </section>
    </section>

  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      query,
      orderBy,
      limit,
      onSnapshot
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyB_KMjAJb2ZmIiQ_0uRXkj_Z4GHaHhQM-w",
      authDomain: "japanese-slots.firebaseapp.com",
      projectId: "japanese-slots",
      storageBucket: "japanese-slots.firebasestorage.app",
      messagingSenderId: "524806796966",
      appId: "1:524806796966:web:ea10a2972e7f6cc25b6667"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const lbEl = document.getElementById('bjLb');
    const saveBtn = document.getElementById('bjSave');
    const nameInput = document.getElementById('bjName');

    const q = query(collection(db, 'blackjack_scores'), orderBy('score','desc'), limit(5));
    onSnapshot(q, (snap) => {
      lbEl.innerHTML = '';
      snap.forEach(doc => {
        const d = doc.data();
        const li = document.createElement('li');
        li.textContent = `${d.name} — ${d.score}`;
        lbEl.appendChild(li);
      });
      if(lbEl.children.length === 0) lbEl.innerHTML = '<li>No scores yet.</li>';
    });

    saveBtn.addEventListener('click', async ()=>{
      const name = (nameInput.value || '').trim() || 'Player';
      const score = Number(document.getElementById('bjCredits').textContent) || 0;
      try{ if(window.isNameBlocked && window.isNameBlocked(name)){ alert('Name contains inappropriate language — please choose another.'); return; } }catch(e){}
      await addDoc(collection(db,'blackjack_scores'), { name, score, createdAt: Date.now() });
      nameInput.value = '';
    });
  </script>

  <script src="js/blackjack.js"></script>

  <footer style="text-align:center;padding:20px;color:var(--dark-gray)">Global leaderboard is a frontend placeholder.</footer>
</body>
</html>


