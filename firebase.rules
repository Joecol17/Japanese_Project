rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // Blackjack scores: allow public reads, but restrict writes so clients
    // cannot spoof server timestamps or arbitrarily large scores.
    match /blackjack_scores/{docId} {
      allow read: if true;

      // Allow create only if the client is authenticated and fields are valid
      allow create: if request.auth != null
        && request.resource.data.name is string
        && request.resource.data.name.size() > 0
        && request.resource.data.name.size() <= 20
        && request.resource.data.score is number
        && request.resource.data.score >= 0
        && request.resource.data.score <= 1000000
        // createdAt must be the server timestamp (request.time) so clients can't forge it
        && request.resource.data.createdAt == request.time;

      // Disallow updates/deletes from clients (scores are append-only)
      allow update, delete: if false;
    }

    // Wallets: clients should not be able to write directly to wallets documents.
    match /wallets/{userId} {
      allow read: if request.auth != null && request.auth.uid == userId;
      // disallow client-side create/update/delete; only server (Admin SDK / Cloud Functions) should modify wallets
      allow write: if false;
    }

    // Fallback: deny everything else by default
    match /{document=**} {
      allow read: if false;
      allow write: if false;
    }
  }
}
